<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prueba de API</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #loading {
            display: none; /* Oculto por defecto */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>

<h1>Formulario de prueba para API</h1>

<form id="formulario">
    <label for="documento">Documento:</label>
    <input type="text" id="documento" name="documento" required>
    <br>
    <label for="nombres">Nombres:</label>
    <input type="text" id="nombres" name="nombres" readonly>
    <br>
    <label for="primer_apellido">Apellido paterno:</label>
    <input type="text" id="primer_apellido" name="primer_apellido" readonly>
    <br>
    <label for="segundo_apellido">Apellido materno:</label>
    <input type="text" id="segundo_apellido" name="segundo_apellido" readonly>
    <br>
    <label for="correo">Correo:</label>
    <input type="email" id="correo" name="correo" readonly>
    <br>
    <label for="celular">Celular:</label>
    <input type="tel" id="celular" name="celular" readonly>
    <br>
    <button type="button" id="btnObtener">Obtener Datos</button>
</form>

<img id="loading" src="loading.gif" alt="Cargando..."/>

<script>
    // Asumimos que este es el token que has obtenido previamente
    const TOKEN_FIJO = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IldTTTRGIiwibmJmIjoxNzE0MDA0MDg0LCJleHAiOjE3MTQwMDUyODQsImlhdCI6MTcxNDAwNDA4NCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM4NiIsImF1ZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NDQzODYifQ.bnjLoXKfXqAi4Jh_CnBUis2tXYTxafQdKKrFdBcOX9M';

    $(document).ready(function() {
        $('#btnObtener').on('click', function() {
            var documento = $('#documento').val();
            if (documento) {
                obtenerDatos(documento, TOKEN_FIJO);
            } else {
                alert('Por favor, ingrese el documento.');
            }
        });
    });

    function obtenerDatos(documento, token) {
        const DATA_ENDPOINT = 'https://mafperu.com.pe/wa_experiencia_crm/api/cliente/ObtenerPorDocumento';

        $('#loading').show();

        fetch(DATA_ENDPOINT + '?documento=' + encodeURIComponent(documento), {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
        .then(response => {
            if (!response.ok) throw new Error('Error al obtener los datos');
            return response.json();
        })
        .then(data => {
            $('#nombres').val(data.Primer_nombre || '');
            $('#primer_apellido').val(data.Apellido_paterno || '');
            $('#segundo_apellido').val(data.Apellido_materno || '');
            $('#correo').val(data.Email || '');
            $('#celular').val(data.Telefono || '');
            $('#loading').hide();
        })
        .catch(error => {
            alert('Error al obtener los datos: ' + error.message);
            $('#loading').hide();
        });
    }
</script>

</body>
</html>
