<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prueba de API</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #loading {
            display: none; /* Oculto por defecto */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>

<h1>Formulario de prueba para API</h1>

<form id="formulario">


    <label for="documento">Documento:</label>
    <input type="text" id="documento" name="documento" required>
    <br>
    <label for="nombres">Nombres:</label>
    <input type="text" id="nombres" name="nombres" readonly>
    <br>
    <label for="primer_apellido">Apellido paterno:</label>
    <input type="text" id="primer_apellido" name="primer_apellido" readonly>
    <br>
    <label for="segundo_apellido">Apellido materno:</label>
    <input type="text" id="segundo_apellido" name="segundo_apellido" readonly>
    <br>
    <label for="correo">Correo:</label>
    <input type="email" id="correo" name="correo" readonly>
    <br>
    <label for="celular">Celular:</label>
    <input type="tel" id="celular" name="celular" readonly>
    <br>
    <button type="button" id="btnObtener">Obtener Datos</button>
</form>

<img id="loading" src="loading.gif" alt="Cargando..."/> <!-- Asegúrate de tener un GIF de carga con el nombre loading.gif -->

<script>

    // Este es el endpoint de tu API para autenticación
    const AUTH_ENDPOINT = 'https://aaec-181-176-116-93.ngrok-free.app/api/login/authenticate';

    // Estos son ejemplos de credenciales, debes obtenerlas de manera segura
    const USERNAME = 'WSM4F';
    const PASSWORD = '=6O%Hi@Dyu';

    // Función para autenticar y obtener el token
    function autenticar() {
        return fetch(AUTH_ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username: USERNAME, password: PASSWORD })
        })
            .then(response => {
                if (!response.ok) throw new Error('Falló la autenticación');
                return response.json();
            })
            .then(data => {
                // Aquí asumimos que el endpoint devuelve un objeto que contiene el token en la propiedad 'token'
                return data.token;
            });
    }

    $(document).ready(function() {
        $('#btnObtener').on('click', function() {
            var documento = $('#documento').val();
            if (documento) {
                // Primero autenticamos para obtener el token
                autenticar().then(token => {
                    // Ahora usamos el token para obtener los datos
                    obtenerDatos(documento, token);
                }).catch(error => {
                    console.error('Error en la autenticación:', error);
                });
            } else {
                alert('Por favor, ingrese el documento.');
            }
        });
    });

    function obtenerDatos(documento, token) {
        // Asumimos que este es el endpoint de tu API para obtener los datos
        const DATA_ENDPOINT = 'https://aaec-181-176-116-93.ngrok-free.app/api/cliente/ObtenerPorDocumento';

        $('#loading').show();

        fetch(DATA_ENDPOINT + '?documento=' + encodeURIComponent(documento), {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
            .then(response => {
                if (!response.ok) throw new Error('Error al obtener los datos');
                return response.json();
            })
            .then(data => {
                $('#nombres').val(data.Nombres || '');
                $('#primer_apellido').val(data.Onetoone_apellidopaterno || '');
                $('#segundo_apellido').val(data.Onetoone_apellidomaterno || '');
                $('#correo').val(data.Email || '');
                $('#celular').val(data.MobilePhone || '');
                $('#loading').hide();
            })
            .catch(error => {
                alert('Error al obtener los datos: ' + error.message);
                $('#loading').hide();
            });
    }
</script>

</body>
</html>

